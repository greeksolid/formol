(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1267:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var helpers_extends=__webpack_require__(3),extends_default=__webpack_require__.n(helpers_extends),objectWithoutProperties=__webpack_require__(9),objectWithoutProperties_default=__webpack_require__.n(objectWithoutProperties),regenerator=__webpack_require__(37),regenerator_default=__webpack_require__.n(regenerator),slicedToArray=__webpack_require__(17),slicedToArray_default=__webpack_require__.n(slicedToArray),asyncToGenerator=__webpack_require__(52),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),classCallCheck=__webpack_require__(5),classCallCheck_default=__webpack_require__.n(classCallCheck),possibleConstructorReturn=__webpack_require__(6),possibleConstructorReturn_default=__webpack_require__.n(possibleConstructorReturn),getPrototypeOf=__webpack_require__(7),getPrototypeOf_default=__webpack_require__.n(getPrototypeOf),createClass=__webpack_require__(4),createClass_default=__webpack_require__.n(createClass),inherits=__webpack_require__(8),inherits_default=__webpack_require__.n(inherits),assertThisInitialized=__webpack_require__(11),assertThisInitialized_default=__webpack_require__.n(assertThisInitialized),toConsumableArray=__webpack_require__(45),toConsumableArray_default=__webpack_require__.n(toConsumableArray),defineProperty=__webpack_require__(85),defineProperty_default=__webpack_require__.n(defineProperty),objectSpread=__webpack_require__(20),objectSpread_default=__webpack_require__.n(objectSpread),fa=__webpack_require__(109),md=__webpack_require__(1203),dist=__webpack_require__(1202),dist_default=__webpack_require__.n(dist),react=__webpack_require__(1),react_default=__webpack_require__.n(react),deep_equal=__webpack_require__(63),deep_equal_default=__webpack_require__.n(deep_equal),utils=__webpack_require__(10),Preview_b=Object(utils.a)("Preview");function Preview(_ref){var data=_ref.data,ext=_ref.ext,mime=_ref.mime;if("image/svg+xml"===mime)ext="svg";else{var _mime$split=mime.split("/");ext=slicedToArray_default()(_mime$split,2)[1]}data="data:".concat(mime,";base64,").concat(data);var type=ext.toLowerCase();return["pdf","svg"].includes(type)?react_default.a.createElement("object",{data:data,className:Preview_b.m({type:"pdf"})}):["jpg","jpeg","png","gif","tiff"].includes(type)?react_default.a.createElement("img",{src:data,className:Preview_b.m({type:"image"}),alt:ext}):null}var _class,_class2,_temp,multipleAdapter=__webpack_require__(118);__webpack_require__.d(__webpack_exports__,"default",function(){return FileField_FileField});var key=function(file){return[file.name,file.ext].join(".")},FileField_rename=function(files){return files.reverse().reduce(function(_ref,file){var renamed=_ref.renamed,counter=_ref.counter,name=file.name.replace(/--\d+$/,""),k=key(objectSpread_default()({},file,{name:name})),newCounter=objectSpread_default()({},counter,defineProperty_default()({},k,k in counter?counter[k]+1:0));return{counter:newCounter,renamed:toConsumableArray_default()(renamed).concat([objectSpread_default()({},file,{name:newCounter[k]?"".concat(name,"--").concat(newCounter[k]):name})])}},{renamed:[],counter:{}}).renamed.reverse()},FileField_FileField=Object(multipleAdapter.a)(_class=Object(utils.a)((_temp=_class2=function(_React$PureComponent){function FileField(props){var _this;return classCallCheck_default()(this,FileField),(_this=possibleConstructorReturn_default()(this,getPrototypeOf_default()(FileField).call(this,props))).state={value:null,rejected:[]},_this.dropzone=react_default.a.createRef(),_this.handleDrop=_this.handleDrop.bind(assertThisInitialized_default()(assertThisInitialized_default()(_this))),_this.handleRemove=_this.handleRemove.bind(assertThisInitialized_default()(assertThisInitialized_default()(_this))),_this}return inherits_default()(FileField,_React$PureComponent),createClass_default()(FileField,null,[{key:"valueToField",value:function(value,multiple){return value?multiple?value.map(key).join(","):key(value):""}}]),createClass_default()(FileField,[{key:"fileToObject",value:function(){var _fileToObject=asyncToGenerator_default()(regenerator_default.a.mark(function _callee(file){var _nameExt,_nameExt2,name,ext;return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _nameExt=Object(utils.c)(file.name),_nameExt2=slicedToArray_default()(_nameExt,2),name=_nameExt2[0],ext=_nameExt2[1],_context.t0=name,_context.t1=ext,_context.t2=file.type,_context.t3=file.size,_context.next=7,Object(utils.e)(file);case 7:return _context.t4=_context.sent.split(",",2)[1],_context.abrupt("return",{name:_context.t0,ext:_context.t1,type:_context.t2,size:_context.t3,data:_context.t4});case 9:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _fileToObject.apply(this,arguments)}}()},{key:"handleChange",value:function(value,rejected){var _this$props=this.props,i18n=_this$props.i18n,multiple=_this$props.multiple;(0,_this$props.onChange)(value,rejected.length?multiple?"".concat(i18n.file.rejectedMultiple," (").concat(rejected.join(", "),")"):i18n.file.rejected:"")}},{key:"handleDrop",value:function(){var _handleDrop=asyncToGenerator_default()(regenerator_default.a.mark(function _callee2(acceptedFiles,rejectedFiles){var _this$props2,value,multiple,onFocus,onBlur,current,rejected,files,newFiles,newValue;return regenerator_default.a.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _this$props2=this.props,value=_this$props2.value,multiple=_this$props2.multiple,onFocus=_this$props2.onFocus,onBlur=_this$props2.onBlur,current=_this$props2.elementRef.current,onFocus(),rejected=this.state.rejected,rejectedFiles=rejectedFiles.filter(function(maybeFile){return maybeFile.name}),_context2.next=6,Promise.all(acceptedFiles.concat(rejectedFiles).map(this.fileToObject));case 6:files=_context2.sent,rejectedFiles.length&&(rejected=toConsumableArray_default()(rejected).concat(toConsumableArray_default()(files.slice(-rejectedFiles.length).map(key)))),newFiles=multiple?FileField_rename(toConsumableArray_default()(files).concat(toConsumableArray_default()(value))):files[0],newValue=FileField.valueToField(newFiles,multiple),multiple||(rejected=rejected.includes(newValue)?[newValue]:[]),current.value=newValue,this.handleChange(newFiles,rejected),this.setState({value:newValue,rejected:rejected}),onBlur();case 15:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2,_x3){return _handleDrop.apply(this,arguments)}}()},{key:"handleRemove",value:function(e,file){var _this$props3=this.props,value=_this$props3.value,multiple=_this$props3.multiple,current=_this$props3.elementRef.current,onFocus=_this$props3.onFocus,onBlur=_this$props3.onBlur;onFocus();var changed=multiple?value.filter(function(f){return key(f)!==key(file)}):null,rejected=this.state.rejected.filter(function(rej){return rej!==key(file)}),newValue=FileField.valueToField(changed,multiple);current.value=newValue,this.handleChange(changed,rejected),this.setState({value:newValue,rejected:rejected}),e.stopPropagation(),onBlur()}},{key:"renderPreview",value:function(b,file){var _this2=this,_this$props4=this.props,disabled=_this$props4.disabled,readOnly=_this$props4.readOnly,rejected=this.state.rejected,fileKey=key(file);return react_default.a.createElement("figure",{className:b.e("preview").m({error:rejected.includes(fileKey)}),key:fileKey},react_default.a.createElement("div",{className:b.e("image-delete")},react_default.a.createElement(Preview,{data:file.data,mime:file.type,ext:file.ext}),readOnly||disabled?null:react_default.a.createElement("button",{className:b.e("close"),onClick:function(e){return _this2.handleRemove(e,file)},type:"button"},react_default.a.createElement(fa.d,null)," Enlever")),react_default.a.createElement("figcaption",{className:b.e("preview-caption")},react_default.a.createElement("span",{className:b.e("preview-name")},fileKey),file.size&&react_default.a.createElement("span",{className:b.e("preview-size")},Object(utils.b)(file.size)),file.type&&react_default.a.createElement("span",{className:b.e("preview-type")},file.type)))}},{key:"render",value:function(b){var _this3=this,_this$props5=this.props,name=_this$props5.name,value=_this$props5.value,i18n=_this$props5.i18n,accept=_this$props5.accept,placeholder=_this$props5.placeholder,className=_this$props5.className,multiple=_this$props5.multiple,readOnly=_this$props5.readOnly,disabled=_this$props5.disabled,elementRef=_this$props5.elementRef,inputProps=(_this$props5.onChange,_this$props5.onKeyDown,objectWithoutProperties_default()(_this$props5,["name","value","i18n","accept","placeholder","className","multiple","readOnly","disabled","elementRef","onChange","onKeyDown"])),rejected=this.state.rejected,preview=null;return multiple?preview=value.map(function(file){return _this3.renderPreview(b,file)}):value&&(preview=this.renderPreview(b,value)),readOnly||disabled?react_default.a.createElement("div",{className:b.mix(className)},preview||i18n.file.noFile):react_default.a.createElement("div",{className:b.m({invalid:!!rejected.length})},react_default.a.createElement(dist_default.a,{accept:accept||"image/*",className:b.e("dropzone").s,activeClassName:b.e("dropzone").m({active:!0}).s,acceptClassName:b.e("dropzone").m({accept:!0}).s,rejectClassName:b.e("dropzone").m({reject:!0}).s,disabledClassName:b.e("dropzone").m({disabled:!0}).s,name:name,ref:this.dropzone,multiple:multiple,onDrop:this.handleDrop},function(_ref2){var getRootProps=_ref2.getRootProps,getInputProps=_ref2.getInputProps,isDragActive=_ref2.isDragActive;return react_default.a.createElement("div",extends_default()({},getRootProps(),{className:b.e("dropzone-wrapper").m({isDragActive:isDragActive})}),"ï¿¼ ",react_default.a.createElement("input",getInputProps()),react_default.a.createElement("div",{className:b.e("placeholder")},!multiple&&preview?preview:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(md.a,null),react_default.a.createElement("span",null,placeholder))))}),multiple&&react_default.a.createElement("div",{className:b.e("previews")},preview),react_default.a.createElement("input",extends_default()({className:b.mix(className).e("hidden-input"),ref:elementRef},inputProps,{value:FileField.valueToField(value,multiple),onChange:utils.d,type:"text"})))}}],[{key:"getDerivedStateFromProps",value:function(newProps,_ref3){var oldValue=_ref3.value,oldRejected=_ref3.rejected,multiple=newProps.multiple,current=newProps.elementRef.current,rawValue=newProps.value,value=FileField.valueToField(rawValue,multiple);if(!deep_equal_default()(value,oldValue)){var rejected=oldRejected.filter(function(f){return multiple?value.split(",").includes(f):value===f});return current&&(current.value=value),{value:value,rejected:rejected}}return null}}]),FileField}(react_default.a.PureComponent),_class2.displayName="FileField",_class=_temp))||_class)||_class}}]);
//# sourceMappingURL=FileField.49d60d8c0c421718fd3f.bundle.js.map